# ISSUE: Python非ユーザーが本プロジェクトを実行利用するための提供形態（Webアプリ/EXE配布を避ける前提）

> 位置づけ: **将来検討（今の改良スコープ外）**

## 背景 / 制約

- 本プロジェクトは Python + ClearML を前提としているが、利用者が “Python非ユーザー” のケースを想定したい。
- ただし以下は避けたい:
  - Streamlit 等の Webアプリを作って運用する（運用/保守コスト増）
  - exe などの配布（環境差分や更新で保守が難しい）
- 可能なら “設定を入力して実行 → ClearMLで結果を見る” の導線は維持したい。

## 目的（このISSUEで議論したいこと）

- Python非ユーザーが、最小の手順で “実行できる” ための提供形態を検討する
- 何を重視するか（導入容易性/運用容易性/セキュリティ/再現性）別に To-Be 案を整理し、
  - 決めるべき方針事項
  - 必要な開発項目
  - 期待効果 / デメリット
  を明確化する

## まず決めるべき前提（論点の整理）

### A. 実行者の “権限/環境” はどこにあるか

- A1: ClearML Agent が動く社内/クラウド環境に集約（ユーザーPCでは実行しない）
- A2: ユーザーPCでも実行したい（ただしPythonは触らせない）

### B. 入力の受け取り方法

- B1: YAML（既存）をユーザーが編集（最もシンプルだが、非PythonでもYAMLは難しい場合あり）
- B2: “入力フォーム” を別で用意（ただしWebアプリは避けたい）
- B3: ClearML UI の HyperParameters を入力フォーム代わりにする（テンプレtaskの clone）

### C. 実行単位（ユーザーが何をするか）

- C1: pipeline 実行だけ（dataset_id を入れてRun）
- C2: training と inference を分けて実行（recommended_model_id を見て推論）

### D. セキュリティ/ネットワーク

- D1: ユーザーPCから ClearML server へアクセス可能か
- D2: データはどこにあり、ユーザーがアップロードする必要があるか（dataset_id の提供フロー）

## To-Be案（“何を重視するか”別）

### 案A: ClearMLテンプレ運用（UI入力 + Agent実行）を最優先

**重視**

- Python非ユーザーでも “ブラウザだけ” で実行できる（ClearML UI）
- Webアプリを別途作らない

**To-Be像**

- “実行用テンプレタスク” を用意:
  - pipeline template（dataset_id を入力できる）
  - inference template（model_id を入力できる）
- ユーザーは ClearML UI でテンプレを Clone → HyperParameters を編集 → Queue を選んで enqueue
- 実行は ClearML Agent（社内/クラウド）が担当
- 生成されるタスク/Project/命名/タグ規約で、run_id 単位で辿れる

**決めるべき方針**

- テンプレの管理方針（task_idの管理、更新手順、ロールバック）
- ユーザーが編集して良い HyperParameters の最小セット（UI汚染防止）
- Queue の見せ方（ユーザーに選ばせるか固定か）

**必要な開発項目（例）**

- 各phaseの “入力HyperParameters最小化” をさらに徹底（UIを入力フォームとして使うため）
- テンプレ作成/更新手順を docs 化（スクリーンショット不要でも良いが手順は必須）
- 入力のバリデーション（dataset_id 空など）を実行開始時に分かりやすく失敗させる

**メリット**

- Python非ユーザーに配布物不要、ユーザー環境を汚さない
- Webアプリ不要、運用負債が比較的小さい

**デメリット/リスク**

- ClearML 運用（ユーザー管理、権限、queue/agent、テンプレ管理）が前提
- “dataset_id の用意” がユーザーにとって最初の壁になりうる

---

### 案B: “設定ファイルだけ渡す”運用（実行はCI/ジョブとして走らせる）

**重視**

- ユーザーがブラウザ操作すらしない（ファイル提出/依頼ベース）
- 実行環境を中央集約し、再現性を担保する

**To-Be像**

- ユーザーは `pipeline.yaml`（最小）だけを編集して提出（またはフォームから生成）
- 実行は:
  - CI（GitHub Actions / 社内CI）
  - もしくは定期ジョブ（Airflow等）
  が ClearML Agent queue に enqueue する
- 結果は ClearML のURL（training-summary/inference）をユーザーに返す

**決めるべき方針**

- “設定の提出先” をどうするか（Git PR/チケット添付/共有ストレージ）
- 実行のトリガ（手動/定期/イベント）
- 実行失敗時の通知方法（Slack/メール/チケット）

**必要な開発項目（例）**

- config バリデーション（PR時に弾く、またはenqueue前に弾く）
- “run_id の発番規則” と “実行URLの通知” の自動化
- ユーザーが触る config を最小化し、参照用は artifact に退避

**メリット**

- 実行/環境を中央集約し、再現性が最も高い
- 非Pythonユーザーの手順が “ファイル1つ” になる

**デメリット**

- 実行の窓口（運用チーム/CI）が必要で、即時性が落ちる可能性

---

### 案C: コンテナ配布（Docker/Podman）で “Pythonを意識させない” 実行

**重視**

- ユーザーPCで実行したいが、Python環境は触らせたくない
- EXE配布より保守しやすい形に寄せる

**To-Be像**

- `docker run ...` で `run_pipeline` を叩ける形にする（または `make pipeline`）
- config.yaml と inference_config.yaml を volume mount
- ClearML へログを送る（ユーザーPCからサーバに到達できる前提）

**決めるべき方針**

- ユーザーPCに Docker/Podman を許容できるか（セキュリティ/ITポリシー）
- データはどこから読むか（ローカルファイル vs ClearML Dataset）
- GPUが必要な場合の扱い

**必要な開発項目（例）**

- `Dockerfile`（依存の固定、entrypoint、configの渡し方）
- “最小の実行コマンド” を docs にまとめる（dataset_id指定で動く最短導線）
- ローカル実行と Agent実行の差分吸収（ログ/パス/権限）

**メリット**

- EXEより更新・依存管理が容易

**デメリット**

- Docker環境が前提になり、IT制約次第で導入できない

---

### 案D: “YAMLを入力フォーム化する”が、Webアプリではなく “生成ツール” に寄せる

**重視**

- YAML編集が難しい非エンジニア向けに、入力を簡単にする
- ただし常時稼働のWebアプリは避ける

**To-Be像（例）**

- 生成だけを行う仕組み:
  - （例）Google Forms / Microsoft Forms → YAML生成（スクリプト/自動化）
  - （例）Excelテンプレ → YAML変換（社内運用）
- 実行は 案A（ClearML UI）または 案B（CI/ジョブ）に接続する

**決めるべき方針**

- “入力項目の正” をどこに置くか（フォームとYAMLの二重管理を避ける）
- 生成物（YAML）の保存/監査（誰がいつ何を実行したか）

**必要な開発項目（例）**

- YAML schema（入力項目の定義）を固定し、生成/検証を同じschemaで行う
- 生成→実行までの手順（ドキュメント化、責任分界）

**メリット**

- Webアプリ運用なしで入力の敷居を下げられる

**デメリット**

- “フォーム/Excel” の運用が別の負債になり得る（入力項目の追加変更が面倒）

## 推奨の段階導入（案の組み合わせ）

- 短期: 案A（ClearMLテンプレ運用）で “ブラウザだけで実行” を実現
- 組織運用が整ったら: 案B（CI/ジョブ）で実行を中央集約
- ユーザーPC実行が必須なら: 案C（コンテナ）を追加
- YAML編集がボトルネックなら: 案D（生成ツール）を追加

## 判断の単位（受け入れ条件案）

- [ ] Python非ユーザーが “Pythonを触らず” に pipeline を実行できる
- [ ] 入力項目が最小で、誤入力しても分かりやすく失敗する（バリデーション）
- [ ] 実行結果（training-summary）に必ず辿れる（URL/リンク/検索キーがある）
- [ ] 実行環境が再現可能（依存固定、テンプレ/コンテナ/CIのどれか）
- [ ] 運用負債（テンプレ/フォーム/コンテナ）が許容範囲である

## 次アクション（将来タスク案）

1. “実行者はどこか”（A1/A2）と “入力の受け取り”（B1/B3）をまず決める
2. 最小ユースケース（dataset_id 入力→pipeline実行→recommended_model_id確認）で手順を固定
3. テンプレ運用にするなら、テンプレ更新/管理フローを docs 化
4. 失敗時のUX（エラー表示、通知、ログの見方）を定義

## 関連リンク（プロジェクト内）

- `docs/README_user.md`（ユーザー手順がある場合）
- `docs/DEV_GUIDE.md`
- `docs/DEPRECATIONS.md`

